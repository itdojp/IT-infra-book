<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .diagram-text { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; font-size: 12px; fill: var(--color-text-primary, #1a1a1a); }
      .diagram-title { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; font-size: 16px; font-weight: bold; fill: var(--color-text-primary, #1a1a1a); }
      .state-text { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; font-size: 11px; fill: var(--color-text-primary, #1a1a1a); }
      .time-text { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; font-size: 10px; fill: var(--color-text-secondary, #666); }
      .state-disabled { fill: var(--color-text-muted, #999); stroke: var(--color-border, #dee2e6); stroke-width: 2; }
      .state-blocking { fill: var(--color-error-light, #ffebee); stroke: var(--color-error, #d32f2f); stroke-width: 2; }
      .state-listening { fill: var(--color-warning-light, #fff8e1); stroke: var(--color-warning, #f57c00); stroke-width: 2; }
      .state-learning { fill: var(--color-info-light, #e1f5fe); stroke: var(--color-info, #0288d1); stroke-width: 2; }
      .state-forwarding { fill: var(--color-success-light, #e8f5e8); stroke: var(--color-success, #2e7d32); stroke-width: 2; }
      .transition { stroke: var(--color-text-secondary, #666); stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .condition { stroke: var(--color-accent, #ff6b35); stroke-width: 1.5; stroke-dasharray: 5,5; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="var(--color-text-secondary, #666)" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="600" fill="var(--color-bg-primary, #ffffff)"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="diagram-title">図2-3: スパニングツリー収束プロセス</text>
  
  <!-- State Machine Diagram -->
  <text x="400" y="60" text-anchor="middle" class="diagram-text">STPポート状態遷移</text>
  
  <!-- Initial State -->
  <circle cx="120" cy="120" r="40" class="state-disabled"/>
  <text x="120" y="115" text-anchor="middle" class="state-text">Disabled</text>
  <text x="120" y="130" text-anchor="middle" class="state-text">(無効)</text>
  
  <!-- Blocking State -->
  <circle cx="300" cy="120" r="40" class="state-blocking"/>
  <text x="300" y="115" text-anchor="middle" class="state-text">Blocking</text>
  <text x="300" y="130" text-anchor="middle" class="state-text">(ブロック)</text>
  
  <!-- Listening State -->
  <circle cx="480" cy="120" r="40" class="state-listening"/>
  <text x="480" y="115" text-anchor="middle" class="state-text">Listening</text>
  <text x="480" y="130" text-anchor="middle" class="state-text">(リスニング)</text>
  
  <!-- Learning State -->
  <circle cx="660" cy="120" r="40" class="state-learning"/>
  <text x="660" y="115" text-anchor="middle" class="state-text">Learning</text>
  <text x="660" y="130" text-anchor="middle" class="state-text">(ラーニング)</text>
  
  <!-- Forwarding State -->
  <circle cx="480" cy="280" r="40" class="state-forwarding"/>
  <text x="480" y="275" text-anchor="middle" class="state-text">Forwarding</text>
  <text x="480" y="290" text-anchor="middle" class="state-text">(転送)</text>
  
  <!-- Transitions -->
  <line x1="160" y1="120" x2="260" y2="120" class="transition"/>
  <text x="210" y="110" text-anchor="middle" class="time-text">ポート有効化</text>
  
  <line x1="340" y1="120" x2="440" y2="120" class="transition"/>
  <text x="390" y="110" text-anchor="middle" class="time-text">20秒経過</text>
  
  <line x1="520" y1="120" x2="620" y2="120" class="transition"/>
  <text x="570" y="110" text-anchor="middle" class="time-text">15秒経過</text>
  
  <line x1="660" y1="160" x2="520" y2="240" class="transition"/>
  <text x="620" y="210" text-anchor="middle" class="time-text">15秒経過</text>
  
  <!-- Backward transition -->
  <line x1="440" y1="280" x2="340" y2="140" class="condition"/>
  <text x="350" y="220" text-anchor="middle" class="time-text">トポロジ変更検出</text>
  
  <!-- State Descriptions -->
  <text x="400" y="360" text-anchor="middle" class="diagram-title">各状態の動作</text>
  
  <!-- State descriptions table -->
  <rect x="50" y="380" width="700" height="180" fill="var(--color-bg-secondary, #f8f9fa)" stroke="var(--color-border, #dee2e6)" stroke-width="1"/>
  
  <text x="70" y="405" class="state-text" font-weight="bold">Disabled:</text>
  <text x="150" y="405" class="diagram-text">ポートが無効状態。BPDUの送受信なし</text>
  
  <text x="70" y="425" class="state-text" font-weight="bold">Blocking:</text>
  <text x="150" y="425" class="diagram-text">BPDUを受信のみ。データフレーム転送なし</text>
  
  <text x="70" y="445" class="state-text" font-weight="bold">Listening:</text>
  <text x="150" y="445" class="diagram-text">BPDUを送受信。MACアドレス学習なし</text>
  
  <text x="70" y="465" class="state-text" font-weight="bold">Learning:</text>
  <text x="150" y="465" class="diagram-text">MACアドレス学習開始。データ転送なし</text>
  
  <text x="70" y="485" class="state-text" font-weight="bold">Forwarding:</text>
  <text x="150" y="485" class="diagram-text">通常のデータ転送が可能</text>
  
  <!-- Timing Information -->
  <text x="70" y="515" class="diagram-text" font-weight="bold">標準収束時間:</text>
  <text x="70" y="535" class="diagram-text">• 初期収束: 30-50秒 (20秒 + 15秒 + 15秒)</text>
  <text x="70" y="550" class="diagram-text">• RSTP収束: 1-2秒 (高速状態遷移)</text>
  
  <text x="400" y="515" class="diagram-text" font-weight="bold">タイマー設定:</text>
  <text x="400" y="535" class="diagram-text">• Hello Timer: 2秒 (BPDU送信間隔)</text>
  <text x="400" y="550" class="diagram-text">• Forward Delay: 15秒 (状態遷移時間)</text>
  
  <!-- Accessibility -->
  <title>スパニングツリー収束プロセス</title>
  <desc>STPポートの状態遷移とタイマー設定を示すステートマシン図</desc>
</svg>