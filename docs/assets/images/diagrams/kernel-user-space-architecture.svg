<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <title>カーネル/ユーザー空間アーキテクチャ</title>
  <desc>Linuxカーネルとユーザー空間の相互作用、システムコール、権限レベルを示す詳細なアーキテクチャ図</desc>
  <defs>
    <style>
      :root {
        --svg-bg: #ffffff;
        --svg-text: #1a1a1a;
        --svg-primary: #0066cc;
        --svg-success: #16a34a;
        --svg-warning: #ca8a04;
        --svg-error: #dc2626;
        --svg-neutral: #6b7280;
      }
      .title-text { font-family: Inter, 'Helvetica Neue', Arial, sans-serif; font-size: 16px; font-weight: 600; fill: var(--svg-text); }
      .layer-title { font-family: Inter, 'Helvetica Neue', Arial, sans-serif; font-size: 12px; font-weight: 500; fill: var(--svg-bg); }
      .component-text { font-family: Inter, 'Helvetica Neue', Arial, sans-serif; font-size: 12px; font-weight: 400; fill: var(--svg-text); }
      .annotation-text { font-family: Inter, 'Helvetica Neue', Arial, sans-serif; font-size: 10px; font-weight: 400; fill: var(--svg-neutral); }
      .user-space { fill: var(--svg-primary); stroke: var(--svg-primary); stroke-width: 2; }
      .kernel-space { fill: var(--svg-error); stroke: var(--svg-error); stroke-width: 2; }
      .hardware-layer { fill: var(--svg-neutral); stroke: var(--svg-neutral); stroke-width: 2; }
      .system-call { fill: var(--svg-warning); stroke: var(--svg-warning); stroke-width: 2; }
      .data-flow { stroke: var(--svg-primary); stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .interrupt-flow { stroke: var(--svg-error); stroke-width: 2; stroke-dasharray: 5,3; fill: none; marker-end: url(#arrowhead-red); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="var(--svg-primary)"/>
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="var(--svg-error)"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" class="title-text" text-anchor="middle">カーネル/ユーザー空間アーキテクチャ</text>

  <!-- User Space Layer -->
  <g id="user-space">
    <rect x="60" y="60" width="680" height="140" class="user-space" rx="4"/>
    <text x="400" y="80" class="layer-title" text-anchor="middle">ユーザー空間 (Ring 3)</text>
    
    <!-- Applications -->
    <rect x="80" y="90" width="100" height="90" fill="var(--svg-bg)" stroke="var(--svg-primary)" stroke-width="1" rx="4"/>
    <text x="130" y="110" class="component-text" text-anchor="middle" font-weight="500">アプリケーション</text>
    <text x="90" y="125" class="annotation-text">• Webサーバー</text>
    <text x="90" y="140" class="annotation-text">• データベース</text>
    <text x="90" y="155" class="annotation-text">• GUI/CLI</text>
    <text x="90" y="170" class="annotation-text">• プロセス管理</text>
    
    <!-- Libraries -->
    <rect x="200" y="90" width="100" height="90" fill="var(--svg-bg)" stroke="var(--svg-primary)" stroke-width="1" rx="4"/>
    <text x="250" y="110" class="component-text" text-anchor="middle" font-weight="500">ライブラリ</text>
    <text x="210" y="125" class="annotation-text">• glibc</text>
    <text x="210" y="140" class="annotation-text">• libpthread</text>
    <text x="210" y="155" class="annotation-text">• OpenSSL</text>
    <text x="210" y="170" class="annotation-text">• システムライブラリ</text>
    
    <!-- Shell/CLI -->
    <rect x="320" y="90" width="100" height="90" fill="var(--svg-bg)" stroke="var(--svg-primary)" stroke-width="1" rx="4"/>
    <text x="370" y="110" class="component-text" text-anchor="middle" font-weight="500">シェル/CLI</text>
    <text x="330" y="125" class="annotation-text">• bash/zsh</text>
    <text x="330" y="140" class="annotation-text">• systemctl</text>
    <text x="330" y="155" class="annotation-text">• コマンドツール</text>
    <text x="330" y="170" class="annotation-text">• スクリプト</text>
    
    <!-- System Daemons -->
    <rect x="440" y="90" width="100" height="90" fill="var(--svg-bg)" stroke="var(--svg-primary)" stroke-width="1" rx="4"/>
    <text x="490" y="110" class="component-text" text-anchor="middle" font-weight="500">システムデーモン</text>
    <text x="450" y="125" class="annotation-text">• systemd</text>
    <text x="450" y="140" class="annotation-text">• sshd</text>
    <text x="450" y="155" class="annotation-text">• cron</text>
    <text x="450" y="170" class="annotation-text">• NetworkManager</text>
    
    <!-- Container Runtime -->
    <rect x="560" y="90" width="100" height="90" fill="var(--svg-bg)" stroke="var(--svg-primary)" stroke-width="1" rx="4"/>
    <text x="610" y="110" class="component-text" text-anchor="middle" font-weight="500">コンテナランタイム</text>
    <text x="570" y="125" class="annotation-text">• Docker</text>
    <text x="570" y="140" class="annotation-text">• containerd</text>
    <text x="570" y="155" class="annotation-text">• runc</text>
    <text x="570" y="170" class="annotation-text">• Kubernetes</text>
  </g>

  <!-- System Call Interface -->
  <g id="system-call-interface">
    <rect x="80" y="220" width="640" height="60" class="system-call" rx="4"/>
    <text x="400" y="240" class="layer-title" text-anchor="middle">システムコールインターフェース</text>
    
    <rect x="100" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="135" y="258" class="annotation-text" text-anchor="middle">open/read</text>
    
    <rect x="190" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="225" y="258" class="annotation-text" text-anchor="middle">fork/exec</text>
    
    <rect x="280" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="315" y="258" class="annotation-text" text-anchor="middle">socket/bind</text>
    
    <rect x="370" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="405" y="258" class="annotation-text" text-anchor="middle">mmap/brk</text>
    
    <rect x="460" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="495" y="258" class="annotation-text" text-anchor="middle">ioctl/fcntl</text>
    
    <rect x="550" y="240" width="70" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="585" y="258" class="annotation-text" text-anchor="middle">signal/kill</text>
    
    <rect x="640" y="240" width="60" height="30" fill="var(--svg-bg)" stroke="var(--svg-warning)" stroke-width="1" rx="4"/>
    <text x="670" y="258" class="annotation-text" text-anchor="middle">その他</text>
  </g>

  <!-- Kernel Space Layer -->
  <g id="kernel-space">
    <rect x="60" y="300" width="680" height="200" class="kernel-space" rx="4"/>
    <text x="400" y="320" class="layer-title" text-anchor="middle">カーネル空間 (Ring 0)</text>
    
    <!-- Process Management -->
    <rect x="80" y="330" width="120" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="140" y="350" class="component-text" text-anchor="middle" font-weight="500">プロセス管理</text>
    <text x="90" y="365" class="annotation-text">• スケジューラー</text>
    <text x="90" y="380" class="annotation-text">• タスク管理</text>
    <text x="90" y="395" class="annotation-text">• IPC機構</text>
    
    <!-- Memory Management -->
    <rect x="220" y="330" width="120" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="280" y="350" class="component-text" text-anchor="middle" font-weight="500">メモリ管理</text>
    <text x="230" y="365" class="annotation-text">• 仮想メモリ</text>
    <text x="230" y="380" class="annotation-text">• ページング</text>
    <text x="230" y="395" class="annotation-text">• キャッシュ</text>
    
    <!-- File System -->
    <rect x="360" y="330" width="120" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="420" y="350" class="component-text" text-anchor="middle" font-weight="500">ファイルシステム</text>
    <text x="370" y="365" class="annotation-text">• VFS層</text>
    <text x="370" y="380" class="annotation-text">• ext4/XFS</text>
    <text x="370" y="395" class="annotation-text">• バッファキャッシュ</text>
    
    <!-- Network Stack -->
    <rect x="500" y="330" width="120" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="560" y="350" class="component-text" text-anchor="middle" font-weight="500">ネットワークスタック</text>
    <text x="510" y="365" class="annotation-text">• TCP/IP</text>
    <text x="510" y="380" class="annotation-text">• Netfilter</text>
    <text x="510" y="395" class="annotation-text">• ソケット層</text>
    
    <!-- Device Drivers -->
    <rect x="140" y="410" width="140" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="210" y="430" class="component-text" text-anchor="middle" font-weight="500">デバイスドライバー</text>
    <text x="150" y="445" class="annotation-text">• ブロックデバイス</text>
    <text x="150" y="460" class="annotation-text">• キャラクタデバイス</text>
    <text x="150" y="475" class="annotation-text">• ネットワークデバイス</text>
    
    <!-- Security Modules -->
    <rect x="300" y="410" width="140" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="370" y="430" class="component-text" text-anchor="middle" font-weight="500">セキュリティモジュール</text>
    <text x="310" y="445" class="annotation-text">• SELinux/AppArmor</text>
    <text x="310" y="460" class="annotation-text">• Capabilities</text>
    <text x="310" y="475" class="annotation-text">• Namespace/Cgroups</text>
    
    <!-- Core Kernel -->
    <rect x="460" y="410" width="140" height="70" fill="var(--svg-bg)" stroke="var(--svg-error)" stroke-width="1" rx="4"/>
    <text x="530" y="430" class="component-text" text-anchor="middle" font-weight="500">カーネルコア</text>
    <text x="470" y="445" class="annotation-text">• 割り込み処理</text>
    <text x="470" y="460" class="annotation-text">• タイマー管理</text>
    <text x="470" y="475" class="annotation-text">• 同期機構</text>
  </g>

  <!-- Hardware Layer -->
  <g id="hardware-layer">
    <rect x="80" y="520" width="640" height="60" class="hardware-layer" rx="4"/>
    <text x="400" y="540" class="layer-title" text-anchor="middle">ハードウェア層</text>
    
    <text x="140" y="560" class="annotation-text" text-anchor="middle">CPU</text>
    <text x="240" y="560" class="annotation-text" text-anchor="middle">メモリ (RAM)</text>
    <text x="360" y="560" class="annotation-text" text-anchor="middle">ストレージ (SSD/HDD)</text>
    <text x="500" y="560" class="annotation-text" text-anchor="middle">ネットワーク (NIC)</text>
    <text x="620" y="560" class="annotation-text" text-anchor="middle">その他デバイス</text>
  </g>

  <!-- Data Flow Arrows -->
  <path d="M 400 200 L 400 220" class="data-flow"/>
  <path d="M 400 280 L 400 300" class="data-flow"/>
  <path d="M 400 500 L 400 520" class="data-flow"/>
  
  <!-- Interrupt Flow -->
  <path d="M 550 520 L 550 480" class="interrupt-flow"/>
  <text x="560" y="505" class="annotation-text">割り込み</text>
</svg>